### IPC

- Process는 완전히 독립된 실행객체
- 서로 독립되어 있다는 것은 다른 프로세스의 영향을 받지 않는다는 장점 가짐
- 그러나 독립되어 있는 만큼 별도의 설비가 없이는 서로간에 통신이 어렵다는 단점 가짐
- 이를 위해서 커널 영역에서 IPC라는 내부 프로세스간 통신 - Inter Process Communication을 제공하게 되고, 프로세스는 커널이 제공하는 IPC설비를 이용해서 프로세스간 통신을 할 수 있게 됨
- 그러기 위해서는 동시 접근 가능한 메모리, 즉 프로세스들이 공유하는 메모리가 필요함

## 쓰레드 간 통신보다 프로세스 간 통신이 어려운 이유

- Fork 같은 함수로 프로세스를 생성, 이 과정에서 메모리 공간을 복사하여 별도의 자원 할당
- 그렇기에 프로세스는 서로 통신할 수 있는 공간이 없기에(위에서 언급한 독립 공간을 가지기에) 통신을 위한 별도의 공간을 만들어줘야 한다
- pthread_create 함수로 쓰레드를 생성, 메모리 공간과 자원을 공유

## IPC의 두 가지 표준

- IPC의 2가지 표준(System V IPC와 POSIX IPC)
- System V IPC는 오랜 역사를 가진 만큼 이기종간 코드 호환성을 확실히 보장해 주지만, API가 오래되었으며, 함수명도 명확하지 않음
- POSIX IPC는 직관적으로 API가 구성되어 있어서 상대적으로 조금 더 사용하기 쉬움

## IPC 설비

- 상황에 맞는 IPC의 선택은, 특히 fork()를 이용해서 만들어진 멀티 프로세스의 프로그램에 있어서 중요
- 잘못된 IPC 설비의 선택은 코딩과정을 어렵게 만들거나 프로그램의 작동을 효율적이지 못하게 만들 수 있기 때문

## IPC 종류

1. 공유 메모리(Shared Memory)

- 프로세스 간 메모리 영역을 공유해서 사용할 수 있도록 허용
- 프로세스가 공유 메모리 할당을 커널에 요청하면, 커널은 해당 프로세스에 메모리 공간 할당, 그 후 어떤 프로세스 건 해당 메모리 영역에 접근가능하게 됨
- 프로세스 간 Read, Write를 모두 필요로 할 때 사용됨
- 대량의 정보를 다수의 프로세스에게 배포 가능
- 중개자 없이 곧바로 메모리에 접근 가능해서, 모든 IPC 중에 가장 빠르게 작동

2. 파이프(Pipe)

- 통신을 위한 메모리 공간(버퍼)를 생성하여, 프로세스가 데이터를 주고 받게끔 함.
- A. 익명 파이프
- 통신할 프로세스를 명확하게 알 수 있을 때 사용
- 부모-자식 or 형제 프로세스 간에 사용
- 외부 프로세스에 사용 불가능
- 파이프는 두 개의 프로세스를 연결하고, 하나의 프로세스는 데이터를 쓰기만, 다른 하나는 데이터를 읽기만 할 수 있음
- 한쪽 방향으로 통신이 가능해서, 반이중 통신이라고 불리기도함
- 송수신을 모두 하려면 두 개의 파이프를 만들어야 함
- Pipe 함수를 이용해서 생성한다.
- 프로세스 하나에서 읽기와 통신을 모두 하려면, 파이프를 두 개 만들어야해서 구현이 복잡해짐

- B. 네임드 파이프
- 전혀 모르는 상태의 프로세스 사이의 통신에 사용
- FIFO라고 불리는 특수 파일을 이용함
- 외부 프로세스와 통신 가능
- mkfifo or mknod 함수로 생성

3. 소켓(Socket)

- 네트워크 소켓 통신을 통해 데이터를 공유함
- 데이터 교환을 위해 양쪽 PC에 각각 임의의 포트를 정하고, 해당 포트 간의 대화를 통해 데이터를 주고 받는 방식
- 이 때 각각의 PC의 Port를 담당하는 소켓은 각각 하나의 프로세스임
- 해당 프로세스는 임의의 Port를 맡아 데이터를 송수힌 하는 역할을 진행하는 프로세스임
- 각각의 PC에서 프로세스를 통해 타 PC PORT에 연결하라는 명령을 보내면, 두 프로세스는 서로 확인 과정을 거쳐 연결을 진행하고, 연결 후에는 Pipe같이 1대1로 데이터를 주고 받음
- 클라이언트와 서버가 소켓을 통해서 통신하는 구조로, 원격에서 프로세스 간 데이터를 공유할 때 사용됨
- 양방향 통신이 가능
- 서버(Bind, Listen, Accept), 클라이언트 (Connect)
- 연결이 종료되면 소켓을 Close해줘야 함
- 서버/클라이언트 환경을 구축하는데 용이함

4. 메세지 큐

- 입축력 방식은 Named Pipe와 동일
- 메세지 큐는 Named Pipe처럼 데이터의 흐름이 아니라 메모리의 공간임
- Pipe, Named Pipe(Fifo)와 달리 **다수의 프로세스 간 메세지 전달할 수 있음**
- 메세지 접근을 위해서는 Key가 필요함

5. 메모리 맵(Memory Map)

- 공유 메모리처럼 메모리를 공유해줌
- Shared Memory(공유메모리)공간과 마찬가지로 메모리를 공유한다는 측면에 있어서는 서로 비슷한 측면이 있음
- 차이점은 Memory Map의 경우 열린파일을 메모리에 맵핑시켜서, 공유한다는 것(공유 매개체가 파일 + 메모리)
- 파일은 시스템의 전역적인(모두 공유할 수 있는) 자원이므로 **서로 다른 프로세스들끼리 데이터를 공유할 수 있음**
- 주로 대용량 데이터를 공유할 때 사용됨
- File I/O가 느릴 때 사용하면 좋음
- 메모리 맵 파일은 파일의 크기를 바꿀 수 없음

6. RPC(Remote Procedure Call)

- 분산 네트워크 망에서 많이 사용되는 방식
- 분리된 PC에 저장된 데이터를 마치 내 PC에 존재하는 것처럼 데이터를 가져와 통신하는 방법
- Stub을 통해서 마치 자신의 디스크에 존재하는 것처럼 착각을 일으켜 사용하는 방식
- Stub이란 리눅스의 공유 라이브러리의 하나

7. 세마포어(Semaphore)

- IPC 통신에서는 프로세스 간 데이터를 동기화하고 보호하기 위해서 세마포어와 뮤텍스를 사용(공유된 자원에 한번에 하나의 프로세스만을 접근시킬 때)
- 세마포어는 프로세스 간 데이터를 동기화하고 보호하는데 목적을 둠
- 공유된 자원에 여러개의 프로세스가 동시에 접근하면 안되며, 한 번에 하나의 프로세스만 접근가능하도록 할 때 사용됨

출처: https://jwprogramming.tistory.com/54 [개발자를 꿈꾸는 프로그래머:티스토리]
출처: https://dar0m.tistory.com/233
